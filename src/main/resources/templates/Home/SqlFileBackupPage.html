<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Production UI</title>
    <link href="/assets/plugins/simplebar/css/simplebar.css" rel="stylesheet"/>
    <link href="/assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet"/>
    <link href="/assets/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet"/>
    <link href="/assets/plugins/datatable/css/dataTables.bootstrap5.min.css" rel="stylesheet"/>
    <!-- loader-->
    <!--    <link href="/assets/css/pace.min.css" rel="stylesheet"/>-->
    <!--    <script src="/assets/js/pace.min.js"></script>-->
    <!-- Bootstrap CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/bootstrap-extended.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="/assets/css/app.css" rel="stylesheet">
    <link href="/assets/css/icons.css" rel="stylesheet">

    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
    />
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"
    ></script>
    <link
            th:href="@{/assets/plugins/datatable/css/dataTables.bootstrap5.min.css}"
            rel="stylesheet"
    />
    <!-- Include Font Awesome CSS -->
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
</head>

<style>
    .status-button {
        border: none;
        color: #000000;
        padding: 5px 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 4px 2px;
        cursor: pointer;
    }

    #console {
        width: 100%;
        height: 90vh;
        overflow-y: auto;
        padding: 10px;
        border: 1px solid lime;
    }

    .status-green {
        background-color: green;
    }

    .status-red {
        background-color: red;
    }

    /*body {*/
    /*    font-family: Arial, sans-serif;*/
    /*    background-color: #f8f9fa;*/
    /*}*/

    h1 {
        color: #343a40;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .table {
        background-color: #ffffff;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .table thead th {
        background-color: #343a40;
        color: #ffffff;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .table tbody tr:hover {
        background-color: #f1f1f1;
    }

    .table td,
    .table th {
        vertical-align: middle;
        padding: 12px;
    }

    .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
    }

    .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
    }

    .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #8eb9b9;
        padding: 20px 40px; /* Increased padding for more height and width */
        height: 100px; /* Increased height */
    }

    /* Styling for the image */
    .header img {
        height: 70px; /* Adjusted height of the image */
    }

    /* Styling for the center title */
    .header h1 {
        margin: 0;
        font-size: 28px; /* Increased font size */
        flex-grow: 1;
        text-align: center;
    }
</style>

<body>

<header class="header m-1">
    <!-- Image on the left -->
    <img src="/assets/GC Cloud Logo.png" alt="Logo">

    <!-- Centered text -->
    <h1 style="
        display: flex;
        justify-content: center;
        font-weight: 700;
        font-family: fangsong;

      ">Web Production Portal</h1>
</header>

<!--<div class="card">-->
<!--    <div class="card-body">-->
<!--        <div class="table-responsive">-->
<!--            <table id="example2" class="table table-striped table-bordered">-->
<div class="container-fluid">

    <!-------------------------------------Sql/File Backup Started ---------------------------------------------------------->
    <div class="container mt-5">
        <h1 class="text-center mb-4">Backup & Download System</h1>

        <!-- Dropdown -->
        <div class="mb-4">
            <label for="project-dropdown" class="form-label">Select a Project:</label>
            <select id="project-dropdown" class="form-select">
                <option value="">-- Select a Project --</option>
                <option value="Jalshakti">Jalshakti</option>
                <option value="JalNoc">JalNoc</option>
                <option value="Monitoring">Monitoring</option>
                <option value="Soochna">UPID Soochna</option>
                <option value="Pragati">Pragati Portal</option>
                <option value="IWRDUP">Irrigation Water Resource Portal</option>
            </select>
        </div>

        <!-- Buttons -->
        <div id="action-buttons" class="d-flex justify-content-around" style="display: none;">
            <button id="start-backup" class="btn btn-primary">Start SQL/File Backup</button>
            <button id="download-zip" class="btn btn-success">Download .zip Backup</button>
            <button id="download-sql" class="btn btn-success">Download .sql Backup</button>
        </div>
    </div>

    <!-------------------------------------Sql/File Backup Ended ---------------------------------------------------------->

</div>
<div class="col">
    <!-----------------------------------Modal for Sql/File backup------------------>
    <div
            class="modal fade"
            id="confirmationModal"
            tabindex="-1"
            aria-labelledby="confirmationModalLabel"
            aria-hidden="true"
    >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Download Confirmation</h5>
                    <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                    ></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to download the latest <strong id="file-type"></strong> backup for the <strong
                        id="project-name"></strong> project?
                </div>
                <div class="modal-footer">
                    <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                    >
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="confirm-download">
                        Download
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"
></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>


<!---------------------------Script For SQL Backup Started----------------------->
<script>

    const projectDropdown = document.getElementById("project-dropdown");
    const actionButtons = document.getElementById("action-buttons");
    const confirmationModal = new bootstrap.Modal(document.getElementById("confirmationModal"));
    const fileTypeSpan = document.getElementById("file-type");
    const projectNameSpan = document.getElementById("project-name");
    const confirmDownloadButton = document.getElementById("confirm-download");

    // Show buttons when a project is selected
    projectDropdown.addEventListener("change", () => {
        debugger;
        const selectedProject = projectDropdown.value;
        if (selectedProject) {
            actionButtons.style.display = "flex";
        } else {
            actionButtons.style.display = "none";
        }
    });

    // -----------------------------------------------------------------------Handle Backup Start -----------------------------------------------------------------------
    document.getElementById("start-backup").addEventListener("click", () => {
        const selectedProject = projectDropdown.value;
        alert(`Starting backup for project: ${selectedProject}`);
        if (!selectedProject) {
            alert("Please select a project!");
            return;
        }

        let apiUrl;
        switch (selectedProject) {
            case "Jalshakti":
                apiUrl = "https://jalshakti.iwrdup.com/Jalshakti/backup";
                break;
            case "JalNoc":
                apiUrl = "http://localhost:5050/JalNoc/backup";
                break;
            case "Monitoring":
                apiUrl = "https://monitor.iwrdup.com/Monitoring/backup";
                break;
            case "Lms":
                apiUrl = "http://localhost:5050/Lms/backup";
                break;
            case "Dms":
                apiUrl = "http://localhost:5050/Dms/backup";
                break;
            case "Soochna":
                apiUrl = "https://admin.upidgov.in/soochna/backup";
                break;
            case "IWRDUP":
                apiUrl = "https://water.iwrdup.com/IWRDUP/backup";
                break;
            case "Pragati":
                apiUrl = "https://pragati.iwrdup.com/Pragati/backup";
                break;
            default:
                alert("Invalid project selected");
                return;
        }


        // Add API call logic here
        // Call the backend API  (Successfully Completed)
        // fetch(`/data/startBackup?projectName=${selectedProject}`, {
        //     method: "POST",
        // })
        //     .then((response) => {
        //         if (!response.ok) {
        //             throw new Error("Failed to start backup");
        //         }
        //         return response.text();
        //     })
        //     .then((data) => {
        //         alert(`Backup started successfully: ${data}`);
        //     })
        //     .catch((error) => {
        //         console.error(error);
        //         alert("Error starting backup. Please try again.");
        //     });


        // Call the backend API
        fetch(apiUrl, {
            method: "POST",
        })
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Failed to start backup");
                }
                return response.text();
            })
            .then((data) => {
                alert(`Backup started successfully: ${data}`);
            })
            .catch((error) => {
                console.error(error);
                alert("Error starting backup. Please try again.");
            })
    });

    // -----------------------------------------------------------------------Handle Download Confirmation Modal-----------------------------------------------------------------------
    const openModal = (fileType) => {
        const selectedProject = projectDropdown.value;
        fileTypeSpan.textContent = fileType;
        projectNameSpan.textContent = selectedProject;
        confirmationModal.show();
    };

    //-----------------------------Handle .zip download-----------------------------------------------------------------------
    document.getElementById("download-zip").addEventListener("click", () => {
        openModal("zip");
    });

    //----------------------------- Handle .sql download-----------------------------------------------------------------------
    document.getElementById("download-sql").addEventListener("click", () => {
        openModal("sql");
    });

    // Confirm Download
    confirmDownloadButton.addEventListener("click", () => {
        const fileType = fileTypeSpan.textContent;
        const selectedProject = projectNameSpan.textContent;

        alert(`Downloading ${fileType} backup for project: ${selectedProject}`);
        confirmationModal.hide();


        // API call to download the file  using Blob Storage With Respect To Google Drive
        fetch(`/data/downloadBackup?projectName=${selectedProject}&fileType=${fileType}`, {
            method: "POST"
        })
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Failed to download the file.");
                }
                return response.blob();
            })
            .then((blob) => {
                // Create a URL for the file blob and trigger the download
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `${selectedProject}_backup.${fileType}`;
                document.body.appendChild(a);
                a.click();
                a.remove();

                alert(`Successfully downloaded ${fileType} backup for project: ${selectedProject}`);
            })
            .catch((error) => {
                console.error("Error downloading file:", error);
                alert("Error downloading the backup file. Please try again.");
            });


    });
</script>
<!---------------------------Script For SQL Backup Ended----------------------->

</body>
</html>
